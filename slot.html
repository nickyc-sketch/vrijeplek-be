<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Vrijeplek ‚Äî Slot</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css">
  <!-- Inline overrides voor grote checkbox + groene link -->
  <style>
    a.link-green{
      color:hsl(152 60% 34%); font-weight:700; text-decoration:underline;
      text-decoration-thickness:1.5px; text-underline-offset:2px;
    }
    a.link-green:hover{ color:hsl(152 65% 28%); text-decoration-thickness:2px; }
    label.terms{ display:inline-flex; align-items:center; gap:12px; font-weight:700; }
    label.terms input[type="checkbox"]{
      appearance:none; -webkit-appearance:none; width:24px; height:24px; margin:0; cursor:pointer;
      border:2px solid hsl(152 60% 34%); border-radius:6px; background:#fff; display:inline-grid; place-content:center;
    }
    label.terms input[type="checkbox"]::after{
      content:""; width:12px; height:7px; border:3px solid #fff; border-top:0; border-right:0;
      transform:rotate(-45deg) scale(0); transition:transform .12s ease;
    }
    label.terms input[type="checkbox"]:checked{
      background:hsl(152 60% 34%); border-color:hsl(152 60% 34%);
    }
    label.terms input[type="checkbox"]:checked::after{ transform:rotate(-45deg) scale(1); }
    label.terms a.link-green{ pointer-events:auto; }
  </style>
</head>
<body>
<header class="site container">
  <div></div>
  <div class="brand"><span class="wordmark"><strong>Vrijeplek</strong></span></div>
  <nav><a class="btn business" href="/company.html">‚öë Voor bedrijven</a></nav>
</header>

<main class="container">
  <section class="card" style="text-align:center">
    <h2>Vrij slot</h2>
    <div id="slotInfo" class="muted">Laden‚Ä¶</div>
    <hr>
    <div class="grid">
      <div><label>Naam</label><input id="name" placeholder="Jouw naam"></div>
      <div><label>Telefoon</label><input id="phone" placeholder="+32 ‚Ä¶"></div>
      <div style="grid-column:1/-1"><label>Opmerkingen (optioneel)</label>
        <input id="notes" placeholder="Bv. knippen + baard; 2 personen; allergie√´n; ‚Ä¶"></div>
      <!-- Terms checkbox -->
      <div style="grid-column:1/-1; margin-top:6px">
        <label class="terms">
          <input type="checkbox" id="accept_terms" required>
          Ik ga akkoord met
          <a class="link-green" href="/voorwaarden.html" target="_blank" rel="noopener">
            de algemene voorwaarden
          </a> en no-showregeling.
        </label>
      </div>
    </div>
    <p class="muted" style="max-width:700px;margin:8px auto 0">
      Bij het claimen betaal je een <strong>voorschot ‚Ç¨15</strong>. De zaak bevestigt je afspraak.
    </p>
    <div class="row" style="justify-content:center">
      <button id="pay" class="btn yellow">Betaal ‚Ç¨15 met Payconiq</button>
    </div>
  </section>
</main>

<div class="modal" id="payModal">
  <div class="panel">
    <h3>Scan de Payconiq QR</h3>
    <p class="muted">Dit is een voorbeeld. Met Netlify Functions koppel je je echte Payconiq-QR.</p>
    <div id="qrWrap" style="text-align:center">
      <canvas id="qr" width="240" height="240" style="background:#f1f5f9;border:1px dashed #cbd5e1;border-radius:12px"></canvas>
    </div>
    <p id="status" class="muted">Wachten op betaling‚Ä¶</p>
    <div class="row" style="justify-content:flex-end"><button class="btn light" id="closePay">Sluiten</button></div>
  </div>
</div>

<div class="toast"></div>

<script>
  const $=q=>document.querySelector(q);
  const fmtDate = ts=> new Date(ts).toLocaleDateString('nl-BE',{weekday:'short',day:'2-digit',month:'short'});
  const fmtTime = ts=> new Date(ts).toLocaleTimeString('nl-BE',{hour:'2-digit',minute:'2-digit'});
  const slots = ()=> JSON.parse(localStorage.getItem('vpbe_slots')||'[]');
  const saveSlots = a=> localStorage.setItem('vpbe_slots', JSON.stringify(a));

  const id = (location.hash||'').replace('#','');
  let arr = slots();
  let slot = arr.find(s=> s.id===id);
  const info = $('#slotInfo');

  function render(){
    if(!slot){ info.textContent='Slot niet gevonden of verlopen.'; return; }
    info.innerHTML = `
      <article class="slot">
        <div class="title">${slot.bizName} <span class="chip">${slot.sectorName||slot.sector}</span></div>
        <div class="meta">üìÖ ${fmtDate(slot.start)} ‚Ä¢ üìç ${slot.city||''} ${slot.zip||''} ‚Ä¢ üáßüá™</div>
        <div class="timeband">üïí ${fmtTime(slot.start)} ‚Äî ${fmtTime(slot.end)}</div>
      </article>
    `;
  }
  render();

  const toast = (m)=>{ const t=document.querySelector('.toast'); t.textContent=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),2000) };

  // Zorg dat klikken op de link de checkbox niet toggelt
  document.addEventListener('DOMContentLoaded', ()=>{
    document.querySelectorAll('label.terms a').forEach(a=>{
      a.addEventListener('click', e=> e.stopPropagation());
    });
  });

  $('#pay').onclick = async ()=>{
    const name = $('#name').value.trim();
    const phone = $('#phone').value.trim();
    if(!name || !phone){ toast('Vul je naam en telefoon in.'); return; }

    const ok = document.getElementById('accept_terms')?.checked;
    if(!ok){ toast('Vink de voorwaarden aan.'); return; }

    const modal = $('#payModal'); modal.style.display='flex';
    drawQR();

    // DEMO-flow: na 1,2s "betaald"
    setTimeout(()=>{
      $('#status').textContent='Betaling ontvangen (demo). Slot bevestigd.';
      slot.status='locked';
      slot.hold={amount:15, at:Date.now(), name, phone, notes:$('#notes').value.trim()};
      saveSlots(arr.map(s=> s.id===slot.id? slot:s));
      setTimeout(()=>{ modal.style.display='none'; location.href='/feed.html'; }, 900);
    }, 1200);
  };

  $('#closePay').onclick = ()=> $('#payModal').style.display='none';

  function drawQR(){
    const c=document.getElementById('qr'), ctx=c.getContext('2d');
    ctx.fillStyle='#f8fafc'; ctx.fillRect(0,0,c.width,c.height);
    ctx.fillStyle='#94a3b8'; ctx.font='16px Inter, Arial';
    ctx.fillText('QR (voorbeeld)', 70, 120);
  }
</script>
</body>
</html>
