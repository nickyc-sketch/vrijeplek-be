<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Vrijeplek — Voor bedrijven</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
<header class="site container">
  <div></div>
  <div class="brand"><span class="wordmark"><strong>Vrijeplek</strong></span></div>
  <nav><a class="btn business" href="/company.html">⚑ Voor bedrijven</a></nav>
</header>

<main class="container">
  <section class="card">
    <h2 style="text-align:center">Bedrijfsprofiel & Abonnement</h2>
    <p class="muted" style="text-align:center">€9/maand — <strong>eerste maand gratis</strong>. Factuur elke maand per e-mail.</p>

    <div class="grid">
      <div><label>Bedrijfsnaam</label><input id="c_name" placeholder="Barbershop Genk"></div>
      <div><label>BTW-nummer</label><input id="c_vat" placeholder="BE0123.456.789"></div>
      <div><label>Sector</label>
        <select id="c_sector"></select>
      </div>
      <div><label>Website</label><input id="c_site" placeholder="https://..."></div>
      <div><label>Factuur e-mail</label><input id="c_invoice_email" placeholder="boekhouding@bedrijf.be"></div>
      <div><label>Straat & nr</label><input id="c_addr" placeholder="Stationsstraat 1"></div>
      <div><label>Postcode</label><input id="c_zip" placeholder="3600"></div>
      <div><label>Gemeente</label><input id="c_city" placeholder="Genk"></div>
      <div><label>Land</label><input id="c_country" value="België"></div>
      <div style="grid-column:1/-1"><label>Google Reviews (optioneel)</label><input id="c_reviews" placeholder="https://g.page/r/..."></div>
    </div>

   <p>
  <label>
    <input type="checkbox" id="c_terms" required>
    Ik ga akkoord met <a class="link-green" href="/voorwaarden.html" target="_blank" rel="noopener">de algemene voorwaarden</a> en no-showpolicy.
  </label>
</p>
<div class="row" style="justify-content:center">
  <button id="c_save" class="btn light">Gegevens opslaan</button>
  <button id="c_sub" class="btn yellow" disabled>Start gratis maand</button>
</div>

  </section>

  <section class="card">
    <h2>Maak een vrij slot</h2>
    <div class="grid">
      <div><label>Datum</label><input id="date" type="date"></div>
      <div><label>Begin</label><input id="tstart" type="time"></div>
      <div><label>Einde</label><input id="tend" type="time"></div>
      <div><label>Korting %</label><input id="discount" type="number" min="0" max="80" step="5" value="0"></div>
    </div>
    <div class="row">
      <button id="create" class="btn primary">+ Vrij slot</button>
      <button id="seed" class="btn light">Demo-slots</button>
    </div>
  </section>

  <section class="card">
    <h2>Jouw slots</h2>
    <div id="my" class="grid"></div>
  </section>
</main>

<div class="toast"></div>

<script>
  const sectors = [
    {id:'kapper', name:'Kapper/Barbier', emoji:'💇‍♂️'},
    {id:'tandarts', name:'Tandarts', emoji:'🦷'},
    {id:'restaurant', name:'Restaurant', emoji:'🍽️'},
    {id:'hotel', name:'Hotel', emoji:'🏨'},
    {id:'bnb', name:'B&B / Gastenkamer', emoji:'🛏️'},
    {id:'cafe', name:'Café', emoji:'☕'},
    {id:'bar', name:'Bar', emoji:'🍸'},
    {id:'frituur', name:'Frituur/Snackbar', emoji:'🍟'},
    {id:'andere', name:'Andere', emoji:'✨'}
  ];
  const $=q=>document.querySelector(q);
  const fmtDate = ts=> new Date(ts).toLocaleDateString('nl-BE',{weekday:'short',day:'2-digit',month:'short'});
  const fmtTime = ts=> new Date(ts).toLocaleTimeString('nl-BE',{hour:'2-digit',minute:'2-digit'});
  const slots = ()=> JSON.parse(localStorage.getItem('vpbe_slots')||'[]');
  const saveSlots = (a)=> localStorage.setItem('vpbe_slots', JSON.stringify(a));
  const uid = ()=> Math.random().toString(36).slice(2,10);
  const toast = (m)=>{ const t=document.querySelector('.toast'); t.textContent=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),2000) };

  const sectorSel = $('#c_sector'); sectors.forEach(s=>{ const o=document.createElement('option'); o.value=s.id; o.textContent=`${s.emoji} ${s.name}`; sectorSel.appendChild(o); });

  let biz = JSON.parse(localStorage.getItem('vpbe_biz')||'null');

  function formData(){
    return {
      name: $('#c_name').value.trim(),
      vat: $('#c_vat').value.trim(),
      sector: sectorSel.value || 'andere',
      sectorName: (sectors.find(x=>x.id===sectorSel.value)||{}).name || 'Andere',
      site: $('#c_site').value.trim(),
      invoice_email: $('#c_invoice_email').value.trim(),
      addr: $('#c_addr').value.trim(),
      zip: $('#c_zip').value.trim(),
      city: $('#c_city').value.trim(),
      country: $('#c_country').value.trim(),
      reviews: $('#c_reviews').value.trim(),
      id: JSON.parse(localStorage.getItem('vpbe_owner')||'null') || uid(),
      sub_status: (biz && biz.sub_status) || 'none'
    };
  }
  function fill(b){
    if(!b) return;
    $('#c_name').value=b.name||'';
    $('#c_vat').value=b.vat||'';
    sectorSel.value=b.sector||'andere';
    $('#c_site').value=b.site||'';
    $('#c_invoice_email').value=b.invoice_email||'';
    $('#c_addr').value=b.addr||'';
    $('#c_zip').value=b.zip||'';
    $('#c_city').value=b.city||'';
    $('#c_country').value=b.country||'België';
    $('#c_reviews').value=b.reviews||'';
    $('#c_status').textContent = (b.sub_status==='active') ? 'Abonnement: actief.' : (b.sub_status==='trialing' ? 'Abonnement: proefperiode.' : 'Geen actief abonnement.');
  }
  function saveBiz(b){
    localStorage.setItem('vpbe_owner', JSON.stringify(b.id));
    localStorage.setItem('vpbe_biz', JSON.stringify(b));
  }
  fill(biz);

  $('#c_save').onclick=()=>{ biz=formData(); saveBiz(biz); toast('Gegevens opgeslagen.'); };
  $('#c_sub').onclick=()=>{ if(!$('#c_terms').checked){ toast('Vink de voorwaarden aan.'); return; } toast('Abonnement start via Stripe zodra je functies koppelt.'); };

  // Slots
  const date=$('#date'), tstart=$('#tstart'), tend=$('#tend'), discount=$('#discount');

  $('#seed').onclick=()=>{
    const base=Date.now()+60*60*1000;
    const demo=[
      {bizName:(biz&&biz.name)||'Hotel Eden', sector:'hotel', sectorName:'Hotel', city:(biz&&biz.city)||'Hasselt', zip:(biz&&biz.zip)||'3500', start:base, end:base+12*60*60000, discount:15, owner:(biz&&biz.id)||'demo'},
      {bizName:(biz&&biz.name)||'Ristorante Napoli', sector:'restaurant', sectorName:'Restaurant', city:(biz&&biz.city)||'Genk', zip:(biz&&biz.zip)||'3600', start:base, end:base+90*60000, discount:10, owner:(biz&&biz.id)||'demo'}
    ].map(x=> ({...x, id:uid(), deposit:15, status:'open', country:'BE', created:Date.now()}));
    saveSlots(slots().concat(demo));
    renderMy(); toast('Demo-slots toegevoegd');
  };

  $('#create').onclick=()=>{
    biz = JSON.parse(localStorage.getItem('vpbe_biz')||'null') || formData();
    if(!biz.name){ toast('Bewaar eerst je bedrijfsprofiel.'); return; }
    if(!date.value||!tstart.value||!tend.value){ toast('Kies datum, begin en eind.'); return; }
    const start = new Date(`${date.value}T${tstart.value}`).getTime();
    const end = new Date(`${date.value}T${tend.value}`).getTime();
    if(end<=start){ toast('Einde moet na begin liggen.'); return; }
    const s={ id:uid(), bizName:biz.name, sector:biz.sector, sectorName:biz.sectorName, city:biz.city, zip:biz.zip, start, end, discount:Number(discount.value||0), owner:biz.id, deposit:15, status:'open', country:'BE', created:Date.now() };
    saveSlots(slots().concat([s]));
    renderMy(); toast('Slot aangemaakt');
  };

  function renderMy(){
    const owner = JSON.parse(localStorage.getItem('vpbe_owner')||'null');
    const arr = slots().filter(s=> s.owner===owner).sort((a,b)=>a.start-b.start);
    $('#my').innerHTML = arr.map(s => `
      <article class="slot">
        <div class="title">${s.bizName}</div>
        <div class="meta">${fmtDate(s.start)} • ${fmtTime(s.start)} — ${fmtTime(s.end)}</div>
        <div class="meta">${s.city||''} ${s.zip||''} • 🇧🇪</div>
        <div><a class="btn" target="_blank" href="/slot.html#${s.id}">Bekijk</a></div>
      </article>
    `).join('') || '<div class="muted">Nog geen slots.</div>';
  }
  renderMy();
</script>
</body>
</html>
